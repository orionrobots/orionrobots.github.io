name: Add post

on:
  workflow_dispatch:
    inputs:
      slug:
        required: true
        description: post filename
        type: string
      title:
        required: true
        description: post title
        type: string
      content:
        required: true
        description: post content
        type: string
      youtube_id:
        description: Optional youtube id
        tyep: string

jobs:
  add_post:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Add post
        run: |
          file_name="_posts/$(date +%Y-%m-%d)-${{ inputs.slug }}.md"
          echo "---" > $file_name
          echo "title: ${{ inputs.title }}" >> $file_name
          echo "date: $(date +%Y-%m-%dT%H:%M:%S)" >> $file_name
          echo "layout: post" >> $file_name
          echo "---" >> $file_name
          echo "${{ inputs.content }}" >> $file_name
          if [ -z "${{ inputs.youtube_id }}" ]; then
            echo "{% include youtube_responsive src=\"https://www.youtube.com/embed/${{ inputs.youtube_id }}\" %}" >> $file_name
          fi
      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Add post $(date +%Y-%m-%dT%H:%M:%S)"
          git push origin master
